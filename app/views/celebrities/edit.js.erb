$('#mycards').append('<%= j render @celebrities %>');

//get the chart_id for the new celebrity
<% @celebrities.each do |c| %>
  <% puts c.id %>
  //chart_id = $('#celeb-<% c.id %>');
  chart_id = document.getElementById("celeb-<%= c.id %>");
  console.log('<%= c.first_name %>');
<% end %>

//Create initial d3 graph for each celeb
//var barHeight = 50;
window.raw_data = #{celebrity.graph_data}
graph_data = [raw_data[0]/raw_data[4],raw_data[1]/raw_data[4],raw_data[2]/raw_data[4],raw_data[3]/raw_data[4]]

chart_width = $('.all-cards').width() - $('.all-cards').width()*0.01;
//$('#celeb-#{celebrity.id}').width();
chart_height = $('.card').first().height()*0.20;
barHeight = chart_height/4 - .01;

//200;
rounded_corners = 5;
padding = "fill:#f89750;stroke:white;stroke-width:5;fill-opacity:1;stroke-opacity:1;";
min_width = 65;
var letters = ["A","B","C","D"]
var x = d3.scale.linear()
  .domain([0, 1])
  .range([min_width, chart_width]);
var chart = d3.select(".chart")
  .attr("width", chart_width)
  .attr("height", chart_height);
var bar = chart.selectAll("g")
  .data(graph_data)
  .enter().append("g")
  .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });
bar.append("rect")
  .attr("width", x)
  .attr("height", barHeight)
  .attr("style", padding)
  .attr("rx", rounded_corners)
  .attr("ry", rounded_corners);
bar.append("text")
  //.attr("x", function(d) { return x(d) - 3; })
  .attr("x", 10)
  .attr("y", barHeight / 2)
  .attr("dy", ".35em")
  .attr("text-anchor", "start")
  .text(function(d, idx) { return letters[idx] + " " + Math.round(d*100) + '%'; });


//Send unregistered or logged out users to sign up page
$(document).ajaxError(function (e, xhr, settings) {
  if (xhr.status == 401) {
    window.location.replace("/users/sign_up");
  }
});

$('.custom_radio').on('change', function() {
  $(this.parentNode).ajaxSubmit();
});

<% if @celebrities.next_page %>
  $('.pagination').replaceWith('<%= j will_paginate @celebrities %>');
<% else %>
  $(window).off('scroll');
  $('.pagination').remove();
<% end %>



